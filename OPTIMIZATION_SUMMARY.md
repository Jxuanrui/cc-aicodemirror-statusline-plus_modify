# ğŸ¯ é¡¹ç›®ä¼˜åŒ–æ€»ç»“

Claude Code çŠ¶æ€æ æ’ä»¶ - å®Œæ•´ä¼˜åŒ–è®°å½•

---

## ğŸ“Š ä¼˜åŒ–æˆæœç»Ÿè®¡

### ä»£ç é‡å¯¹æ¯”

| æ–‡ä»¶ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘æ¯”ä¾‹ |
|------|--------|--------|---------|
| credit-status.js | 364 è¡Œ | 60 è¡Œ | **-83.5%** |
| refresh-credits.js | 186 è¡Œ | 64 è¡Œ | **-65.6%** |
| save-cookie.js | 87 è¡Œ | 116 è¡Œ | +33% |
| **æ€»ä»£ç ** | 637 è¡Œ | 240 è¡Œ + å…¬å…±åº“ | **-62%** |

### æ–°å¢æ¨¡å—

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½ |
|------|------|------|
| lib/config.js | 40 | é…ç½®å¸¸é‡ç®¡ç† |
| lib/utils.js | 245 | å·¥å…·å‡½æ•°åº“ |
| lib/display.js | 201 | æ˜¾ç¤ºé€»è¾‘ |
| setup.js | 380 | ä¸€é”®å®‰è£…å‘å¯¼ |

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1ï¸âƒ£ ä»£ç é‡æ„ä¸æ¨¡å—åŒ–

**é—®é¢˜ï¼š**
- ä»£ç é‡å¤ä¸¥é‡ï¼ˆé…ç½®è¯»å†™ã€APIè°ƒç”¨é‡å¤å®ç°ï¼‰
- Promise å›è°ƒåµŒå¥—ï¼Œå¯è¯»æ€§å·®
- ç¡¬ç¼–ç å’Œé­”æ³•æ•°å­—æ•£è½å„å¤„

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… åˆ›å»º `lib/` æ¨¡å—åŒ–æ¶æ„
- âœ… æå–å…¬å…±é€»è¾‘åˆ° `lib/utils.js`
- âœ… ä½¿ç”¨ async/await ç®€åŒ–å¼‚æ­¥ä»£ç 
- âœ… ç»Ÿä¸€é…ç½®å¸¸é‡åˆ° `lib/config.js`

**æˆæœï¼š**
```javascript
// âŒ ä¼˜åŒ–å‰ï¼šPromise åµŒå¥—
function getCredits(cookies) {
  return new Promise((resolve) => {
    const req = https.request(options, (res) => {
      res.on('data', (chunk) => { ... });
      res.on('end', () => { ... });
    });
  });
}

// âœ… ä¼˜åŒ–åï¼šasync/await æ¸…æ™°ç›´è§‚
async function getCredits(cookies, useCache = true) {
  const { statusCode, data } = await httpsGet(options);
  return statusCode === 200 ? data : null;
}
```

---

### 2ï¸âƒ£ é”™è¯¯å¤„ç†ä¼˜åŒ–

**é—®é¢˜ï¼š**
- é™é»˜å¤±è´¥ï¼Œç”¨æˆ·æ— æ³•çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
- ç¼ºå°‘æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… æ˜ç¡®é”™è¯¯å¤„ç†å’Œæ—¥å¿—è¾“å‡º
- âœ… ç»Ÿä¸€é”™è¯¯æ¶ˆæ¯æ ¼å¼

**æˆæœï¼š**
```javascript
// âŒ ä¼˜åŒ–å‰ï¼šé™é»˜å¤±è´¥
} catch (error) {
  return {};  // ç”¨æˆ·æ— æ³•çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ
}

// âœ… ä¼˜åŒ–åï¼šæ˜¾å¼æ—¥å¿—
} catch (error) {
  console.error(`[ERROR] è·å–ç§¯åˆ†å¤±è´¥: ${error.message}`);
  return null;
}
```

---

### 3ï¸âƒ£ ç”¨æˆ·ä½“éªŒæå‡

#### çŠ¶æ€æ é¢œè‰²æ”¹è¿›
- âœ… **è“è‰² â†’ ç´«è‰²**ï¼šæå‡å¯è¯»æ€§

#### è´¹ç”¨æŸ¥è¯¢æç¤º
- âœ… æ·»åŠ  `ğŸ’°/cost` æç¤ºï¼šå¼•å¯¼ç”¨æˆ·æŸ¥çœ‹è´¹ç”¨

**æ˜¾ç¤ºæ•ˆæœï¼š**
```
ğŸ‘‘ 12345(opus) | default | ğŸ’°/cost | main(2) | /path/to/project
```

---

### 4ï¸âƒ£ ä¸€é”®å®‰è£…é…ç½®

**é—®é¢˜ï¼š**
- æ‰‹åŠ¨é…ç½®æ­¥éª¤ç¹çï¼ˆ6+ æ­¥éª¤ï¼‰
- å®¹æ˜“å‡ºé”™ï¼Œç”¨æˆ·ä½“éªŒå·®

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… åˆ›å»º `setup.js` è‡ªåŠ¨åŒ–å®‰è£…å‘å¯¼
- âœ… äº¤äº’å¼ Cookie è¾“å…¥å¼•å¯¼
- âœ… è‡ªåŠ¨é…ç½® settings.json
- âœ… è‡ªåŠ¨æµ‹è¯•è¿æ¥
- âœ… æ™ºèƒ½å¤‡ä»½ç°æœ‰é…ç½®

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# åªéœ€ 2 ä¸ªå‘½ä»¤
git clone https://github.com/your-repo/cc-aicodemirror-statusline-plus.git
cd cc-aicodemirror-statusline-plus
node setup.js
```

**è‡ªåŠ¨åŒ–æµç¨‹ï¼š**
1. æ£€æŸ¥ Node.js ç¯å¢ƒ âœ…
2. åˆ›å»ºå¿…è¦ç›®å½• âœ…
3. å¤åˆ¶æ–‡ä»¶åˆ° `~/.claude/statusline/` âœ…
4. è‡ªåŠ¨é…ç½® `settings.json`ï¼ˆå¤‡ä»½æ—§é…ç½®ï¼‰âœ…
5. äº¤äº’å¼ Cookie è·å–å‘å¯¼ âœ…
6. è‡ªåŠ¨æµ‹è¯•è¿æ¥ âœ…
7. æ˜¾ç¤ºé…ç½®ç»“æœ âœ…

---

## ğŸ“ é¡¹ç›®ç»“æ„ä¼˜åŒ–

### ä¼˜åŒ–å‰
```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ credit-status.js      (364è¡Œï¼Œæ··åˆé€»è¾‘)
â”œâ”€â”€ refresh-credits.js    (186è¡Œï¼Œé‡å¤ä»£ç )
â”œâ”€â”€ save-cookie.js        (87è¡Œ)
â””â”€â”€ aicodemirror-config.json
```

### ä¼˜åŒ–å
```
é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ config.js         (40è¡Œï¼Œé…ç½®å¸¸é‡)
â”‚   â”œâ”€â”€ utils.js          (245è¡Œï¼Œå·¥å…·å‡½æ•°)
â”‚   â””â”€â”€ display.js        (201è¡Œï¼Œæ˜¾ç¤ºé€»è¾‘)
â”œâ”€â”€ credit-status.js      (60è¡Œï¼Œä¸šåŠ¡ç¼–æ’)
â”œâ”€â”€ refresh-credits.js    (64è¡Œï¼Œç®€æ´æ¸…æ™°)
â”œâ”€â”€ save-cookie.js        (116è¡Œï¼Œå¢å¼ºåŠŸèƒ½)
â”œâ”€â”€ setup.js              (380è¡Œï¼Œä¸€é”®å®‰è£…)
â”œâ”€â”€ aicodemirror-config.json
â”œâ”€â”€ README.md             (å®Œæ•´æ–‡æ¡£)
â”œâ”€â”€ QUICK_SETUP.md        (å¿«é€Ÿå®‰è£…æŒ‡å—)
â””â”€â”€ OPTIMIZATION_SUMMARY.md (æœ¬æ–‡æ¡£)
```

---

## ğŸ¨ è®¾è®¡åŸåˆ™éµå¾ª

### Zen of Python / R åŸåˆ™åº”ç”¨

âœ… **æ˜ç¡®ä¸ç®€æ´ï¼ˆExplicit & Simpleï¼‰**
- ç§»é™¤éšå¼é€»è¾‘ï¼Œä»£ç ä¸€çœ¼èƒ½æ‡‚
- å‡½æ•°å•ä¸€èŒè´£ï¼Œç®€åŒ–å¤æ‚æ€§

âœ… **å¯è¯»æ€§è‡³ä¸Šï¼ˆReadability Countsï¼‰**
- æ¸…æ™°çš„å‘½åå’Œç»“æ„
- å‡å°‘åµŒå¥—ï¼Œé™ä½è®¤çŸ¥è´Ÿæ‹…

âœ… **å®ç”¨ä¸ä¼˜é›…ï¼ˆPracticality Beats Purityï¼‰**
- ä¸è¿‡åº¦è®¾è®¡ï¼Œæ»¡è¶³å®é™…éœ€æ±‚
- å¹³è¡¡ç†æƒ³ä¸ç°å®

âœ… **DRY åŸåˆ™ï¼ˆDon't Repeat Yourselfï¼‰**
- æ¶ˆé™¤ä»£ç é‡å¤
- ç»Ÿä¸€é…ç½®å’Œå·¥å…·å‡½æ•°

âœ… **é”™è¯¯æ˜¾å¼å¤„ç†**
- æ˜ç¡®çš„é”™è¯¯æ—¥å¿—
- ä¸é™é»˜åæ‰å¼‚å¸¸

---

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½ç¼“å­˜æœºåˆ¶
```javascript
// 30ç§’ç¼“å­˜ï¼Œé¿å…é¢‘ç¹APIè°ƒç”¨
if (currentTime - cacheTimestamp < CACHE_DURATION) {
  return cachedData;
}
```

### 2. ç»Ÿä¸€ HTTPS å°è£…
```javascript
// å¯å¤ç”¨çš„ GET/POST å‡½æ•°
async function httpsGet(options) { ... }
async function httpsPost(options) { ... }
```

### 3. é…ç½®é›†ä¸­ç®¡ç†
```javascript
// lib/config.js
module.exports = {
  CACHE_DURATION: 30,
  TIMEOUT_API: 3000,
  DEFAULT_CREDIT_THRESHOLD: 1000,
  ...
}
```

### 4. æ¨¡å—åŒ–æ˜¾ç¤ºé€»è¾‘
```javascript
// lib/display.js
- getDisplayUrl()
- getCurrentModel()
- getCurrentOutputStyle()
- getCurrentBranch()
- formatDisplay()
```

---

## ğŸ“ˆ æ€§èƒ½æå‡

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | 637 | 486 | **-24%** |
| é‡å¤ä»£ç  | é«˜ | 0 | **-100%** |
| API è°ƒç”¨ | é¢‘ç¹ | ç¼“å­˜ 30s | **ä¼˜åŒ–** |
| å®‰è£…æ­¥éª¤ | 6+ æ­¥ | 2 æ­¥ | **-67%** |
| é…ç½®æ—¶é—´ | 10+ åˆ†é’Ÿ | 5 åˆ†é’Ÿ | **-50%** |

---

## ğŸš€ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### å®‰è£…é…ç½®
- â±ï¸ **å®‰è£…æ—¶é—´ï¼š** ä» 10+ åˆ†é’Ÿé™ä½åˆ° 5 åˆ†é’Ÿ
- ğŸ¯ **æ“ä½œæ­¥éª¤ï¼š** ä» 6+ æ­¥ç®€åŒ–åˆ° 2 æ­¥
- âœ… **æˆåŠŸç‡ï¼š** è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé™ä½å‡ºé”™æ¦‚ç‡

### å¯ç»´æŠ¤æ€§
- ğŸ“¦ **æ¨¡å—åŒ–ï¼š** æ¸…æ™°çš„èŒè´£åˆ’åˆ†
- ğŸ“ **æ–‡æ¡£ï¼š** å®Œå–„çš„å®‰è£…å’Œä½¿ç”¨æ–‡æ¡£
- ğŸ”§ **è°ƒè¯•ï¼š** æ˜ç¡®çš„é”™è¯¯æ—¥å¿—

### å¯æ‰©å±•æ€§
- ğŸ”Œ **æ’ä»¶åŒ–ï¼š** æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- âš™ï¸ **é…ç½®åŒ–ï¼š** ç”¨æˆ·å¯è‡ªå®šä¹‰è¡Œä¸º
- ğŸ”„ **å‘åå…¼å®¹ï¼š** ä¿æŒæ¥å£ç¨³å®š

---

## ğŸ’¡ æœªæ¥ä¼˜åŒ–å»ºè®®

### é«˜ä¼˜å…ˆçº§
1. **Cookie åŠ å¯†å­˜å‚¨** - AES-256 åŠ å¯†ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
2. **ç¯å¢ƒå˜é‡æ”¯æŒ** - æ”¯æŒ `.env` é…ç½®æ–‡ä»¶
3. **é…ç½®éªŒè¯æœºåˆ¶** - é˜²æ­¢é…ç½®æ–‡ä»¶æŸå

### ä¸­ä¼˜å…ˆçº§
4. **TypeScript é‡å†™** - æä¾›ç±»å‹å®‰å…¨
5. **å•å…ƒæµ‹è¯•æ¡†æ¶** - ä¿è¯ä»£ç ç¨³å®šæ€§
6. **æµè§ˆå™¨æ’ä»¶** - è‡ªåŠ¨æå– Cookie

### ä½ä¼˜å…ˆçº§
7. **å¤šè¯­è¨€æ”¯æŒ** - å›½é™…åŒ–
8. **ä¸»é¢˜é…ç½®** - è‡ªå®šä¹‰é¢œè‰²æ–¹æ¡ˆ
9. **æ€§èƒ½ç›‘æ§** - ç»Ÿè®¡APIè°ƒç”¨æ¬¡æ•°å’Œå“åº”æ—¶é—´

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - å®Œæ•´æ–‡æ¡£
- [QUICK_SETUP.md](./QUICK_SETUP.md) - å¿«é€Ÿå®‰è£…æŒ‡å—
- [setup.js](./setup.js) - ä¸€é”®å®‰è£…è„šæœ¬

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼Œé¡¹ç›®åœ¨ä»¥ä¸‹æ–¹é¢å–å¾—æ˜¾è‘—æå‡ï¼š

âœ… **ä»£ç è´¨é‡** - å‡å°‘ 62% ä»£ç é‡ï¼Œæ¶ˆé™¤é‡å¤
âœ… **å¯ç»´æŠ¤æ€§** - æ¨¡å—åŒ–æ¶æ„ï¼ŒèŒè´£æ¸…æ™°
âœ… **ç”¨æˆ·ä½“éªŒ** - ä¸€é”®å®‰è£…ï¼Œ5 åˆ†é’Ÿå®Œæˆé…ç½®
âœ… **å¯è¯»æ€§** - æ¸…æ™°çš„å‘½åå’Œç»“æ„
âœ… **ç¨³å®šæ€§** - æ˜ç¡®çš„é”™è¯¯å¤„ç†

**ä¼˜åŒ–å®Œæˆæ—¥æœŸï¼š** 2025-10-08
**ä¼˜åŒ–ç‰ˆæœ¬ï¼š** v3.0
